---
title: "Attribute Pretest Comparisons: Five Studies"
date: "`r format(Sys.Date(), '%B %d, %Y')`"
output:
  pdf_document:
    toc: yes
    toc_depth: 2
    extra_dependencies: ["booktabs", "longtable", "array"]
geometry: margin=0.5in
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE)
library(dplyr)
library(knitr)
library(kableExtra)
library(qualtRics)
library(effsize)

# Set up Qualtrics API credentials
qualtrics_api_credentials(
  api_key = "BJ6aDiEgtQihneCgtZycVLYjaj0ao9gYkdRkb1UZ",
  base_url = "yul1.qualtrics.com",
  install = FALSE,
  overwrite = TRUE
)

# Function to clean scale values from Qualtrics
clean_scale <- function(x) {
  x <- as.character(x)
  # Handle Qualtrics text anchors
  x <- case_when(
    grepl("Not at all important.*1", x) ~ "1",
    grepl("Very important.*7", x) ~ "7",
    TRUE ~ x
  )
  # Remove non-numeric characters
  x <- gsub("[^0-9]", "", x)
  return(as.numeric(x))
}

# Function to calculate comparison statistics
calculate_comparison <- function(data, var1, var2, var1_name, var2_name) {
  # Paired t-test since same participants rate both
  test <- t.test(data[[var1]], data[[var2]], paired = TRUE)

  # Calculate means and SDs
  mean1 <- mean(data[[var1]], na.rm = TRUE)
  mean2 <- mean(data[[var2]], na.rm = TRUE)
  sd1 <- sd(data[[var1]], na.rm = TRUE)
  sd2 <- sd(data[[var2]], na.rm = TRUE)

  # Cohen's d for paired samples
  diff <- data[[var1]] - data[[var2]]
  cohen_d <- mean(diff, na.rm = TRUE) / sd(diff, na.rm = TRUE)

  # Create result row
  result <- data.frame(
    Comparison = paste(var1_name, "vs", var2_name),
    Mean_Gender_Race = round(mean1, 3),
    SD_Gender_Race = round(sd1, 3),
    Mean_Other = round(mean2, 3),
    SD_Other = round(sd2, 3),
    P_Value = ifelse(test$p.value < 0.001, "<0.001", round(test$p.value, 4)),
    Cohen_D = round(cohen_d, 3)
  )

  return(result)
}
```

# Study 1A: Gender Biopic Pretest

```{r study1a}
# Fetch gender biopic pretest data
gender_biopic_data <- fetch_survey(
  surveyID = "SV_2mky9SMX7AwaQya",
  verbose = FALSE
)

# Clean data
clean_gender_biopic <- gender_biopic_data %>%
  filter(Finished == TRUE) %>%
  filter(!is.na(ec_1_1) & !is.na(ec_2)) %>%
  select(ResponseId,
         importance_female = importance_1,      # Feature a female protagonist
         importance_budget = importance_2,      # Had a big budget (>$40 million)
         importance_recent = importance_3,      # Were released after 2010
         importance_political = importance_4) %>%  # Feature a political leader
  mutate(across(starts_with("importance_"), clean_scale)) %>%
  filter(complete.cases(importance_female, importance_budget,
                       importance_recent, importance_political))

# Create comparison table
comparisons_1a <- rbind(
  calculate_comparison(clean_gender_biopic,
                      "importance_female", "importance_budget",
                      "Feature a female protagonist", "Had a big budget (>$40 million)"),
  calculate_comparison(clean_gender_biopic,
                      "importance_female", "importance_recent",
                      "Feature a female protagonist", "Were released after 2010"),
  calculate_comparison(clean_gender_biopic,
                      "importance_female", "importance_political",
                      "Feature a female protagonist", "Feature a political leader")
)

# Display table
kable(comparisons_1a,
      caption = "Study 1A: Gender Biopic - Importance Rating Comparisons",
      col.names = c("Comparison",
                    "Mean (Gender)", "SD",
                    "Mean (Other)", "SD",
                    "p-value", "Cohen's D"),
      booktabs = TRUE,
      longtable = TRUE) %>%
  kable_styling(latex_options = c("striped", "hold_position", "scale_down"),
                font_size = 8,
                full_width = FALSE) %>%
  column_spec(1, width = "4cm") %>%
  column_spec(2:7, width = "1.2cm")

cat("Sample size:", nrow(clean_gender_biopic), "\n")
```

# Study 1B: Race Biopic Pretest

```{r study1b}
# Fetch race biopic pretest data
race_biopic_data <- fetch_survey(
  surveyID = "SV_2cbaXVDl66VOsAu",
  verbose = FALSE
)

# Clean data
clean_race_biopic <- race_biopic_data %>%
  filter(Finished == TRUE) %>%
  filter(!is.na(ec_1_1) & !is.na(ec_2)) %>%
  select(ResponseId,
         importance_minority = importance_1,    # Feature a racial minority protagonist
         importance_budget = importance_2,      # Had a big budget (>$40 million)
         importance_recent = importance_3,      # Were released after 2010
         importance_runtime = importance_4) %>%   # Have a runtime over 2 hrs
  mutate(across(starts_with("importance_"), clean_scale)) %>%
  filter(complete.cases(importance_minority, importance_budget,
                       importance_recent, importance_runtime))

# Create comparison table
comparisons_1b <- rbind(
  calculate_comparison(clean_race_biopic,
                      "importance_minority", "importance_budget",
                      "Feature a racial minority protagonist", "Had a big budget (>$40 million)"),
  calculate_comparison(clean_race_biopic,
                      "importance_minority", "importance_recent",
                      "Feature a racial minority protagonist", "Were released after 2010"),
  calculate_comparison(clean_race_biopic,
                      "importance_minority", "importance_runtime",
                      "Feature a racial minority protagonist", "Have a runtime over 2 hrs")
)

# Display table
kable(comparisons_1b,
      caption = "Study 1B: Race Biopic - Importance Rating Comparisons",
      col.names = c("Comparison",
                    "Mean (Race)", "SD",
                    "Mean (Other)", "SD",
                    "p-value", "Cohen's D"),
      booktabs = TRUE,
      longtable = TRUE) %>%
  kable_styling(latex_options = c("striped", "hold_position", "scale_down"),
                font_size = 8,
                full_width = FALSE) %>%
  column_spec(1, width = "4cm") %>%
  column_spec(2:7, width = "1.2cm")

cat("Sample size:", nrow(clean_race_biopic), "\n")
```

# Study 2A: Gender Author Pretest

```{r study2a}
# Fetch gender author pretest data
gender_author_data <- fetch_survey(
  surveyID = "SV_0CIP2gGqtp1GHVI",
  verbose = FALSE
)

# Clean data
clean_gender_author <- gender_author_data %>%
  filter(Finished == TRUE) %>%
  filter(!is.na(ec_1_1) & !is.na(ec_2)) %>%
  select(ResponseId,
         importance_female = importance_1,      # Female author
         importance_historical = importance_2,  # Born in 1800s
         importance_prolific = importance_3,    # Wrote more than 10 books
         importance_poetry = importance_4) %>%    # Wrote poetry
  mutate(across(starts_with("importance_"), clean_scale)) %>%
  filter(complete.cases(importance_female, importance_historical,
                       importance_prolific, importance_poetry))

# Create comparison table
comparisons_2a <- rbind(
  calculate_comparison(clean_gender_author,
                      "importance_female", "importance_historical",
                      "Female author", "Born in 1800s"),
  calculate_comparison(clean_gender_author,
                      "importance_female", "importance_prolific",
                      "Female author", "Wrote more than 10 books"),
  calculate_comparison(clean_gender_author,
                      "importance_female", "importance_poetry",
                      "Female author", "Wrote poetry")
)

# Display table
kable(comparisons_2a,
      caption = "Study 2A: Gender Author - Importance Rating Comparisons",
      col.names = c("Comparison",
                    "Mean (Gender)", "SD",
                    "Mean (Other)", "SD",
                    "p-value", "Cohen's D"),
      booktabs = TRUE,
      longtable = TRUE) %>%
  kable_styling(latex_options = c("striped", "hold_position", "scale_down"),
                font_size = 8,
                full_width = FALSE) %>%
  column_spec(1, width = "4cm") %>%
  column_spec(2:7, width = "1.2cm")

cat("Sample size:", nrow(clean_gender_author), "\n")
```

# Study 2B: Race Author Pretest

```{r study2b}
# Fetch race author pretest data
race_author_data <- fetch_survey(
  surveyID = "SV_5tBTklIN9MdyBqC",
  verbose = FALSE
)

# Clean data
clean_race_author <- race_author_data %>%
  filter(Finished == TRUE) %>%
  filter(!is.na(ec_1_1) & !is.na(ec_2)) %>%
  select(ResponseId,
         importance_minority = importance_1,    # Minority author
         importance_historical = importance_2,  # Born in 1800s
         importance_prolific = importance_3,    # Wrote more than 10 books
         importance_poetry = importance_4) %>%    # Wrote poetry
  mutate(across(starts_with("importance_"), clean_scale)) %>%
  filter(complete.cases(importance_minority, importance_historical,
                       importance_prolific, importance_poetry))

# Create comparison table
comparisons_2b <- rbind(
  calculate_comparison(clean_race_author,
                      "importance_minority", "importance_historical",
                      "Minority author", "Born in 1800s"),
  calculate_comparison(clean_race_author,
                      "importance_minority", "importance_prolific",
                      "Minority author", "Wrote more than 10 books"),
  calculate_comparison(clean_race_author,
                      "importance_minority", "importance_poetry",
                      "Minority author", "Wrote poetry")
)

# Display table
kable(comparisons_2b,
      caption = "Study 2B: Race Author - Importance Rating Comparisons",
      col.names = c("Comparison",
                    "Mean (Race)", "SD",
                    "Mean (Other)", "SD",
                    "p-value", "Cohen's D"),
      booktabs = TRUE,
      longtable = TRUE) %>%
  kable_styling(latex_options = c("striped", "hold_position", "scale_down"),
                font_size = 8,
                full_width = FALSE) %>%
  column_spec(1, width = "4cm") %>%
  column_spec(2:7, width = "1.2cm")

cat("Sample size:", nrow(clean_race_author), "\n")
```

# Study 4: Biography Pretest

```{r study4}
# Fetch biography pretest data
biography_data <- fetch_survey(
  surveyID = "SV_eVSIWRL55XQbIiO",
  verbose = FALSE
)

# Clean data - need to determine actual attribute labels from survey
clean_biography <- biography_data %>%
  filter(Finished == TRUE) %>%
  filter(!is.na(ec_1_1) & !is.na(ec_2)) %>%
  select(ResponseId,
         importance_female = importance_1,      # Female subject (to be verified)
         importance_attr2 = importance_2,       # To be determined from survey
         importance_attr3 = importance_3,       # To be determined from survey
         importance_attr4 = importance_4) %>%     # To be determined from survey
  mutate(across(starts_with("importance_"), clean_scale)) %>%
  filter(complete.cases(importance_female, importance_attr2,
                       importance_attr3, importance_attr4))

# Check if we have data
if(nrow(clean_biography) > 0) {
  # Create comparison table (labels to be updated based on actual survey content)
  comparisons_4 <- rbind(
    calculate_comparison(clean_biography,
                        "importance_female", "importance_attr2",
                        "Female subject", "Attribute 2 (TBD)"),
    calculate_comparison(clean_biography,
                        "importance_female", "importance_attr3",
                        "Female subject", "Attribute 3 (TBD)"),
    calculate_comparison(clean_biography,
                        "importance_female", "importance_attr4",
                        "Female subject", "Attribute 4 (TBD)")
  )

  # Display table
  kable(comparisons_4,
        caption = "Study 4: Biography - Importance Rating Comparisons (Labels TBD)",
        col.names = c("Comparison",
                      "Mean (Gender)", "SD",
                      "Mean (Other)", "SD",
                      "p-value", "Cohen's D"),
        booktabs = TRUE,
        longtable = TRUE) %>%
    kable_styling(latex_options = c("striped", "hold_position", "scale_down"),
                  font_size = 8,
                  full_width = FALSE) %>%
    column_spec(1, width = "4cm") %>%
    column_spec(2:7, width = "1.2cm")

  cat("Sample size:", nrow(clean_biography), "\n")
} else {
  cat("No data available for Study 4 biography pretest.\n")
  cat("Please verify survey ID or data availability.\n")
}
```

# Summary

This document presents pairwise comparisons from attribute importance pretests conducted across five studies. Each table shows:

- **Mean values** (1-7 importance scale) for gender/race attributes vs other attributes
- **Standard deviations** (SD) for both attributes
- **P-values** from paired t-tests (same participants rated all attributes)
- **Cohen's D** effect size for paired samples

## Survey Mapping

1. **Study 1A**: Gender Biopic Pretest (SV_2mky9SMX7AwaQya)
2. **Study 1B**: Race Biopic Pretest (SV_2cbaXVDl66VOsAu)
3. **Study 2A**: Gender Author Pretest (SV_0CIP2gGqtp1GHVI)
4. **Study 2B**: Race Author Pretest (SV_5tBTklIN9MdyBqC)
5. **Study 4**: Biography Pretest (SV_eVSIWRL55XQbIiO)

The pretests were designed to ensure that gender/race attributes were not significantly different in perceived importance from other attributes used as control conditions in the main experiments. Mean values around 4 (middle of the 1-7 scale) indicate moderate importance ratings across attributes.